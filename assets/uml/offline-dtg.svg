<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="372px" preserveAspectRatio="none" style="width:772px;height:372px;" version="1.1" viewBox="0 0 772 372" width="772px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wu3sbp1gqm3j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="30" y1="38.2969" y2="164.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="30" x2="30" y1="164.8281" y2="205.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30" x2="30" y1="205.6328" y2="332.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541.5" x2="541.5" y1="38.2969" y2="164.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="541.5" x2="541.5" y1="164.8281" y2="205.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="541.5" x2="541.5" y1="205.6328" y2="332.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="698.5" y1="38.2969" y2="164.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="698.5" x2="698.5" y1="164.8281" y2="205.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="698.5" y1="205.6328" y2="332.1641"/><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="22.9951">App</text><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="331.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="351.1592">App</text><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="461.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="468.5" y="22.9951">LocalAssetsManager</text><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="461.5" y="331.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="468.5" y="351.1592">LocalAssetsManager</text><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="631.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="638.5" y="22.9951">ContentManager</text><rect fill="#FEFECE" filter="url(#f1wu3sbp1gqm3j)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="631.5" y="331.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="638.5" y="351.1592">ContentManager</text><polygon fill="#A80036" points="529.5,65.4297,539.5,69.4297,529.5,73.4297,533.5,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="535.5" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="37.5" y="64.3638">mediaSource = getPreferredDownloadableMediaSource(for: entry)</text><polygon fill="#A80036" points="686.5,94.5625,696.5,98.5625,686.5,102.5625,690.5,98.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="692.5" y1="98.5625" y2="98.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="37.5" y="93.4966">addItem(id: entry.id, url: mediaSource.contentUrl)</text><polygon fill="#A80036" points="686.5,123.6953,696.5,127.6953,686.5,131.6953,690.5,127.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="692.5" y1="127.6953" y2="127.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="396" x="37.5" y="122.6294">loadItemMetadata(id: entry.id, preferredVideoBitrate: 300000)</text><polygon fill="#A80036" points="686.5,152.8281,696.5,156.8281,686.5,160.8281,690.5,156.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="692.5" y1="156.8281" y2="156.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="37.5" y="151.7622">startItem(id: entry.id)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="328.5" y="189.0386">Downloading</text><polygon fill="#A80036" points="41.5,222.7656,31.5,226.7656,41.5,230.7656,37.5,226.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="35.5" x2="697.5" y1="226.7656" y2="226.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="47.5" y="221.6997">finished</text><polygon fill="#A80036" points="686.5,251.8984,696.5,255.8984,686.5,259.8984,690.5,255.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="692.5" y1="255.8984" y2="255.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="37.5" y="250.8325">playbackUrl = itemPlaybackUrl(id: entry.id)</text><polygon fill="#A80036" points="529.5,281.0313,539.5,285.0313,529.5,289.0313,533.5,285.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="535.5" y1="285.0313" y2="285.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="487" x="37.5" y="279.9653">registerDownloadedAsset(location:playbackUrl, mediaSource: mediaSource)</text><polygon fill="#A80036" points="41.5,310.1641,31.5,314.1641,41.5,318.1641,37.5,314.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="35.5" x2="540.5" y1="314.1641" y2="314.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="47.5" y="309.0981">done</text><!--
@startuml offline-dtg

participant App
participant LocalAssetsManager as LAM
participant ContentManager as CM

App->LAM: mediaSource = getPreferredDownloadableMediaSource(for: entry)

App->CM: addItem(id: entry.id, url: mediaSource.contentUrl)
App->CM: loadItemMetadata(id: entry.id, preferredVideoBitrate: 300000)
App->CM: startItem(id: entry.id)

... Downloading ...

CM- ->App: finished
App->CM: playbackUrl = itemPlaybackUrl(id: entry.id)
App->LAM: registerDownloadedAsset(location:playbackUrl, mediaSource: mediaSource)
LAM- ->App: done

@enduml

PlantUML version 1.2019.03(Sun Mar 10 07:04:44 EDT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.7.0_131-b00
Operating System: Linux
OS Version: 3.13.0-76-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>