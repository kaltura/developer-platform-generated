  <title>Kaltura Session authentication for iOS</title>

  <meta name="description" content="VPaaS allows you to build cloud video services, supplies SDKs, and works on all devices, media workflows, and applications. Pay as you go. 
">
    <meta property="st:title" content="Kaltura Session authentication for iOS" >
    <meta property="st:published_at" content="">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
window.jQuery = window.jquery;
</script>
  <script type="text/javascript">
    try{Typekit.load();}catch(e){}
  </script>
  <link rel="apple-touch-icon" href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript">
    var switchTo5x=true;
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>

  
<script type="text/javascript">
    	
	//back to top
	if ($('#back-to-top').length) {
    		var scrollTrigger = 100, // px
	        backToTop = function () {
	            var scrollTop = $(window).scrollTop();
	            if (scrollTop > scrollTrigger) {
	                $('#back-to-top').addClass('show');
	            } else {
	                $('#back-to-top').removeClass('show');
	            }
	        };
	    backToTop();
	    $(window).on('scroll', function () {
	        backToTop();
	    });
	    $('#back-to-top a:first-child').on('click', function (e) {
	        e.preventDefault();
	        $('html,body').animate({
	            scrollTop: 0
	        }, 700);
	    });
	}

</script>

<script src='https://www.google.com/recaptcha/api.js'></script>
<script>
function verify_recapcha()
{
	var isCaptchaValidated = false;
	var response = grecaptcha.getResponse();
	if(response.length == 0) {
	    isCaptchaValidated = false;
	    alert('Please confirm that you are a Human.');
	    return false;
	} else {
	    return true;
	}

}
</script>
<!--script type="text/javascript" src="assets/js/webflow.js"></script>
<script type="text/javascript" src="assets/js/opentip-jquery.js"></script-->
    <!--script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("176893769");
  </script-->

<!--link rel="stylesheet" type="text/css" href="assets/css/lity.min.css"-->
<!--script type="text/javascript" src="assets/js/lity.min.js"></script-->

  <!-- RTP tag -->
<script type='text/javascript'>
(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
})(window,document,"rtp","https://sjrtp3-cdn.marketo.com/rtp-api/v1/rtp.js","kaltura");
rtp('send','view');
rtp('get', 'campaign',true);
</script>
<!-- End of RTP tag -->




    <div class="page-content">
      <div class="wrapper">
          <!--link rel="stylesheet" href="/site.css"-->
<article>


<div class="w-section side-nav-section">
    <div class="w-container">
      <!--a href="#" data-ix="show-temp-page-nav-column" class="w-button w-clearfix mobilebtn">Topics<span class="fa fa-chevron-down" style="null"></span></a-->
      <div class="w-row body-columns">
        <div class="docs-contents">
          <div class="post-header">

            <!-- INSERT JEKYLL CONTENT HERE -->

          	<header class="post-header">
    			<h1 class="post-title">Kaltura Session authentication for iOS</h1>
  			</header>

			
			
			<div class="lastcommittable">
				<span>Updated: Mon Mar 25 10:23:04 2019</span>, By <span class="commit-author">tzubeli</span> <a class="editgithub" href="https://github.com/kaltura/developer-platform-docs/tree/master/documentation/player-portal/ios/kaltura-session-authentication-ios.md" target="_blank">Contribute to this page</a>
				<!--tr><td>Created on: Tue Mar 19 11:23:35 2019, By: Avital</td></tr-->
				<!--tr><td>Last commit: Mon Mar 25 10:23:04 2019, By <span class="commit-author">tzubeli</span></td></tr-->
			
				<!-- 
				
				<tr>
					<td>Avital (1 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>tzubeli (1 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!--  -->

			</div>

			

		</div>

            <div class="post-content">
    		
    		<h1 id="kaltura-session-authentication">Kaltura Session Authentication</h1>

<p>The Kaltura Session is an authorization string that identifies the user watching the video. This guide will demonstrate how to create a Kaltura Session on the client side using the Application Token API. An Application Token is used in cases where different applications with varying permissions need access to your Kaltura account, without using your Admin Secret. The appToken is created and customized by the account administrator, and then used by the developers to generate Kaltura Sessions for their respective applications.</p>

<h3 id="create-the-application-token">Create the Application Token</h3>

<p>You can create an appToken with the <a href="https://developer.kaltura.com/console/service/appToken/action/add">appToken.add</a> action. Once you’ve created it, hold on to its token and ID as you’ll need those to create the session. You can also see a list of all available appTokens by using <a href="https://developer.kaltura.com/console/service/appToken/action/list">appToken.list</a>.</p>

<p>There are a few steps to creating a KS with an appToken.</p>
<ol>
  <li><strong>Generate a basic kaltura session:</strong> because all calls to the API <em>must</em> include a Kaltura Session, we first use the session API to create what is called a <strong>widget session</strong>, which has limited functionality and is used in the following steps</li>
  <li><strong>Create a Token Hash</strong> of the appToken token and the widget session, combined.</li>
  <li><strong>Call the appToken.startSession API</strong> with the widget session, the appToken ID, and the hash string. <br />
You can see all these steps interactively with <a href="https://developer.kaltura.com/workflows/Generate_API_Sessions/App_Token_Authentication">this workflow</a> but examples below are written for client-side swift code.</li>
</ol>

<p>Let’s get started. If you’re already creating a Kaltura Session on the server side, you can skip these steps.</p>

<p><strong>Step 1: Generate a widget session</strong> <br />
To get a basic KS, we need to construct a URL request to the <a href="https://developer.kaltura.com/api-docs/service/session/action/startWidgetSession">session.startWidgetSession</a> service. It needs your widget ID, which is basically just your partnerID with an underscore prefix. <br />
So let’s create a function called <code class="highlighter-rouge">generateWidgetSession()</code> and form that URL.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>func generateWidgetSession() -&gt; String {
    let widgetPartnerId = "_\(PARTNER_ID)"
    let widgetKsURL = NSString(format:"https://www.kaltura.com/api_v3/service/session/action/startWidgetSession?widgetId=%@&amp;format=1",widgetPartnerId)
</code></pre>
</div>

<p>Call the endpoint and extract the <code class="highlighter-rouge">ks</code> string from the response. Your code should obviously include more error handling than this example. The complete function looks something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
func generateWidgetSession() -&gt; String {
    let widgetPartnerId = "_\(PARTNER_ID)"

    let widgetKsURL = NSString(format:"https://www.kaltura.com/api_v3/service/session/action/startWidgetSession?widgetId=%@&amp;format=1",widgetPartnerId)

    let widgetKsData = try! Data(contentsOf: URL(string: widgetKsURL as String)!)

    let widgetKsDict = try! JSONSerialization.jsonObject(with: widgetKsData, options: []) as! [String:Any]

    return (widgetKsDict["ks"] as! String)
    }
</code></pre>
</div>

<p>We will call this function from another new function called <code class="highlighter-rouge">generateSession()</code> where you should call the create new variables for the widgetSession, appToken, the appToken ID, and the userId - which can be any string that identifies the user creating the session.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>func generateSession() {
    let widgetKs: String = generateWidgetSession()
    let appToken = "&lt;TOKEN_OF_APP_TOKEN&gt;"
    let appTokenId = "&lt;ID_OF_APP_TOKEN&gt;"
    let userId = "user"
</code></pre>
</div>

<p><strong>Step 2: Create the token hash</strong></p>

<p>You’ll need to install and import a library of your choice for creating the hash string. We chose a library called <a href="https://cocoapods.org/pods/Arcane">Arcane</a> which is like the Obj-C CommonCrypto library. Concatenate the widget session with the appToken token, and create the hash string. <em>Note that you must use the same Hash Type that you used to create the appToken.</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>let tokenHash: String = Hash.SHA256("\(widgetKs)\(appToken)")!
</code></pre>
</div>

<p><strong>Step 3: Get the Kaltura Session</strong></p>

<p>Once you have that hash string, you can now form the URL, make the call to <a href="https://developer.kaltura.com/console/service/appToken/action/startSession">appToken.startSession</a>, and extract the KS from the response. Again, a proper application should include error handling when making calls to the API.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>let URLString = NSString(format:"https://www.kaltura.com/api_v3/service/apptoken/action/startsession?ks=%@&amp;userId=%@&amp;id=%@&amp;tokenHash=%@&amp;format=1",widgetKs,userId,appTokenId,tokenHash)

let ksData = try! Data(contentsOf: URL(string: URLString as String)!)

let ksDict = try! JSONSerialization.jsonObject(with: ksData, options: []) as! [String:Any]
</code></pre>
</div>
<p>Lastly, set the application’s <code class="highlighter-rouge">ks</code> to the newly generated KS:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>self.ks = (ksDict["ks"] as! String)
</code></pre>
</div>
<p>The complete <code class="highlighter-rouge">generateSession()</code> function looks like this:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>func generateSession() {
    let appToken = "c9883312395bf5ed4fd5c9a5d86c985c"
    let userId = "avital.tzubeli@kaltura.com"
    let appTokenId = "0_xeu31jy5"

    let widgetKs: String = generateWidgetSession()

    let tokenHash: String = Hash.SHA256("\(widgetKs)\(appToken)")!

    let URLString = NSString(format:"https://www.kaltura.com/api_v3/service/apptoken/action/startsession?ks=%@&amp;userId=%@&amp;id=%@&amp;tokenHash=%@&amp;format=1",widgetKs,userId,appTokenId,tokenHash)

    let ksData = try! Data(contentsOf: URL(string: URLString as String)!)
    let ksDict = try! JSONSerialization.jsonObject(with: ksData, options: []) as! [String:Any]

    self.ks = (ksDict["ks"] as! String)
}
</code></pre>
</div>
<blockquote>
  <p>Note that if an appToken is deleted, it can no longer be used for session creation.</p>
</blockquote>

		
</article>


      </div>
    </div>

<!-- customer.io -->
<!--script type="text/javascript">
    var _cio = _cio || [];
    (function() {
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', 'd52b0167909beb4a2cf0');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
    })();
  </script-->
  <!-- marketo -->
  <script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('984-SDM-859');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'https://munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

<!--script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5745bb1095edd5f5"></script-->
