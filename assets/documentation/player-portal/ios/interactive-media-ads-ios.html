  <title>Interactive Media Ads for iOS</title>

  <meta name="description" content="VPaaS allows you to build cloud video services, supplies SDKs, and works on all devices, media workflows, and applications. Pay as you go. 
">
    <meta property="st:title" content="Interactive Media Ads for iOS" >
    <meta property="st:published_at" content="">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
window.jQuery = window.jquery;
</script>
  <script type="text/javascript">
    try{Typekit.load();}catch(e){}
  </script>
  <link rel="apple-touch-icon" href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript">
    var switchTo5x=true;
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>

  
<script type="text/javascript">
    	
	//back to top
	if ($('#back-to-top').length) {
    		var scrollTrigger = 100, // px
	        backToTop = function () {
	            var scrollTop = $(window).scrollTop();
	            if (scrollTop > scrollTrigger) {
	                $('#back-to-top').addClass('show');
	            } else {
	                $('#back-to-top').removeClass('show');
	            }
	        };
	    backToTop();
	    $(window).on('scroll', function () {
	        backToTop();
	    });
	    $('#back-to-top a:first-child').on('click', function (e) {
	        e.preventDefault();
	        $('html,body').animate({
	            scrollTop: 0
	        }, 700);
	    });
	}

</script>

<script src='https://www.google.com/recaptcha/api.js'></script>
<script>
function verify_recapcha()
{
	var isCaptchaValidated = false;
	var response = grecaptcha.getResponse();
	if(response.length == 0) {
	    isCaptchaValidated = false;
	    alert('Please confirm that you are a Human.');
	    return false;
	} else {
	    return true;
	}

}
</script>
<!--script type="text/javascript" src="assets/js/webflow.js"></script>
<script type="text/javascript" src="assets/js/opentip-jquery.js"></script-->
    <!--script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("176893769");
  </script-->

<!--link rel="stylesheet" type="text/css" href="assets/css/lity.min.css"-->
<!--script type="text/javascript" src="assets/js/lity.min.js"></script-->

  <!-- RTP tag -->
<script type='text/javascript'>
(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
})(window,document,"rtp","https://sjrtp3-cdn.marketo.com/rtp-api/v1/rtp.js","kaltura");
rtp('send','view');
rtp('get', 'campaign',true);
</script>
<!-- End of RTP tag -->




    <div class="page-content">
      <div class="wrapper">
          <!--link rel="stylesheet" href="/site.css"-->
<article>


<div class="w-section side-nav-section">
    <div class="w-container">
      <!--a href="#" data-ix="show-temp-page-nav-column" class="w-button w-clearfix mobilebtn">Topics<span class="fa fa-chevron-down" style="null"></span></a-->
      <div class="w-row body-columns">
        <div class="docs-contents">
          <div class="post-header">

            <!-- INSERT JEKYLL CONTENT HERE -->

          	<header class="post-header">
    			<h1 class="post-title">Interactive Media Ads for iOS</h1>
  			</header>

			
			
			<div class="lastcommittable">
				<span>Updated: Mon Mar 25 05:47:58 2019</span>, By <span class="commit-author">tzubeli</span> <a class="editgithub" href="https://github.com/kaltura/developer-platform-docs/tree/master/documentation/player-portal/ios/interactive-media-ads-ios.md" target="_blank">Contribute to this page</a>
				<!--tr><td>Created on: Tue Mar 19 11:23:35 2019, By: Avital</td></tr-->
				<!--tr><td>Last commit: Mon Mar 25 05:47:58 2019, By <span class="commit-author">tzubeli</span></td></tr-->
			
				<!-- 
				
				<tr>
					<td>Avital (1 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>tzubeli (2 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!--  -->

			</div>

			

		</div>

            <div class="post-content">
    		
		<p>This document describes the steps required for adding support for the IMA Plugin functionality on iOS devices. IMA (or Interactive Media Ads) was developed by Google to enable you to display ads in your application’s video, audio, and game content. To learn more about Google’s IMA, see <a href="https://developers.google.com/interactive-media-ads/">Google’s IMA developer’s site</a>.</p>

<blockquote>
  <p>Supported IMA SDK Version is: 3.5.2</p>
</blockquote>
      <h2 id="common-issues">
        
        
          Common Issues <a href="#common-issues"></a>
        
        
      </h2>

<ol>
  <li>There is currently an open issue with IMA SDK where removing the player view before destroying the ads manager will cause an error on the next ad playback. To fix the issue all you have to do is call the <code class="highlighter-rouge">player.destroy()</code> before <code class="highlighter-rouge">player.removeFromSuperview()</code></li>
</ol>

<p>If you get below error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Error Domain=com.kaltura.playkit.error.ima Code=1005 "Ads cannot be requested because the ad container is not attached to the view hierarchy." UserInfo={errorType=1, NSLocalizedDescription=Ads cannot be requested because the ad container is not attached to the view hierarchy.}
</code></pre>
</div>

<p>Please make sure that the order of removing player on your side is:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">player</span><span class="o">.</span><span class="nf">destroy</span><span class="p">()</span>
<span class="n">player</span><span class="o">.</span><span class="nf">removeFromSuperview</span><span class="p">()</span>
</code></pre>
</div>

<ol>
  <li>When not including ads, the PlayerEvent observed events start occurring after calling prepare().<br />
When including ads, none of the PlayerAd events occur after calling prepare().</li>
</ol>

<p>To resolve this issue and get <code class="highlighter-rouge">autoPlay</code> with ads please make sure to call play() before those events start occurring.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// Firstly call prepare</span>
<span class="n">player</span><span class="o">.</span><span class="nf">prepare</span><span class="p">()</span>
<span class="c1">// Then immediately </span>
<span class="n">player</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
</code></pre>
</div>
    
      <h2 id="enable-ima-plugins-for-the-kaltura-video-player">
        
        
          Enable IMA Plugins for the Kaltura Video Player <a href="#enable-ima-plugins-for-the-kaltura-video-player"></a>
        
        
      </h2>

<p>To enable the IMA Plugin on iOS devices for the Kaltura Video Player, add the following line to your Podfile:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">pod</span> <span class="s2">"PlayKit_IMA"</span>
</code></pre>
</div>
    
      <h2 id="control-ad-play">
        
        
          Control Ad Play <a href="#control-ad-play"></a>
        
        
      </h2>

<p>To control ad play during runtime, implement the following Video Player delegate method:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">playerShouldPlayAd</span><span class="p">(</span><span class="n">_</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
</div>
    
      <h2 id="register-the-ima-plugin">
        
        
          Register the IMA Plugin <a href="#register-the-ima-plugin"></a>
        
        
      </h2>

<p>Next, register the IMA Plugin inside your application as follows:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kt">PlayKitManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">registerPlugin</span><span class="p">(</span><span class="kt">IMAPlugin</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
</code></pre>
</div>
    
      <h2 id="configure-the-kaltura-video-player-to-use-the-ima-plugin">
        
        
          Configure the Kaltura Video Player to Use the IMA Plugin <a href="#configure-the-kaltura-video-player-to-use-the-ima-plugin"></a>
        
        
      </h2>

<p>To configure the player to use IMA Plugin, add the following configuration to your <code class="highlighter-rouge">PlayerConfig</code> file as follows:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">adsConfig</span> <span class="o">=</span> <span class="kt">IMAConfig</span><span class="p">()</span>
<span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">adTagUrl</span><span class="p">:</span> <span class="err">'</span><span class="n">your</span> <span class="n">ad</span> <span class="n">tag</span> <span class="n">url</span><span class="err">'</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">pluginConfig</span> <span class="o">=</span> <span class="kt">PluginConfig</span><span class="p">(</span><span class="nv">config</span><span class="p">:</span> <span class="p">[</span><span class="kt">IMAPlugin</span><span class="o">.</span><span class="nv">pluginName</span><span class="p">:</span> <span class="n">adsConfig</span><span class="p">])</span>
</code></pre>
</div>
    
      <h2 id="configure-clickthroughs">
        
        
          Configure Clickthroughs <a href="#configure-clickthroughs"></a>
        
        
      </h2>

<p>The IMA Plugin offers two options for opening ad landing pages:</p>

<ul>
  <li>Via an in-app browser</li>
  <li>Via Safari</li>
</ul>

<p>By default, the plugin will open pages using Safari. To update the plugin to use an in-app browser, you’ll need to set the <code class="highlighter-rouge">webOpenerPresentingController</code> value in the AdsConfig object as follows:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">webOpenerPresentingController</span><span class="p">:</span> <span class="n">webOpenerPresentingController</span><span class="p">)</span>
</code></pre>
</div>
    
      <h2 id="add-companion-ads">
        
        
          Add Companion Ads <a href="#add-companion-ads"></a>
        
        
      </h2>

<p>To see companion ads in the device, you’ll need to implement the following steps:</p>

<ol>
  <li>Configure an ad tag to return a companion ad (prepare this in advance).</li>
  <li>Supply a companion ad container to the plugin using the following format (make sure the size of the companion being returned is the same size as the UIView in which you’re trying to display it):</li>
</ol>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">companionView</span><span class="p">:</span> <span class="n">companionView</span><span class="p">)</span>
</code></pre>
</div>
    
      <h2 id="specify-the-desired-bitrate-and-video-formats">
        
        
          Specify the Desired Bitrate and Video Formats <a href="#specify-the-desired-bitrate-and-video-formats"></a>
        
        
      </h2>

<p>The IMA Plugin enables you to specify the video formats and bitrate using the following configuration:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">videoMimeTypes</span><span class="p">:</span> <span class="p">[</span><span class="s">"video/mp4"</span><span class="p">,</span> <span class="s">"application/x-mpegURL"</span><span class="p">])</span>
<span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">videoBitrate</span><span class="p">:</span> <span class="mi">1024</span><span class="p">)</span>
</code></pre>
</div>
    
      <h2 id="specify-the-localized-ad-language">
        
        
          Specify the Localized Ad Language <a href="#specify-the-localized-ad-language"></a>
        
        
      </h2>

<p>The IMA Plugin enables you to specify the language to be used to localize ads and the Video Player UI controls.</p>

<p>To do so, set the language parameter of the AdsConfig to the appropriate language code using <a href="https://developers.google.com/interactive-media-ads/docs/sdks/ios/ads#languagecodes">this reference</a>.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">adsConfig</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="nv">language</span><span class="p">:</span> <span class="s">"en"</span><span class="p">)</span>
</code></pre>
</div>
    
      <h2 id="listen-to-ad-events">
        
        
          Listen to Ad Events <a href="#listen-to-ad-events"></a>
        
        
      </h2>

<p>Use the following code to listen to ad events:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="kt">PKEvent</span><span class="o">.</span><span class="k">Type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AdEvent</span><span class="o">.</span><span class="n">adDidRequestPause</span><span class="p">,</span> <span class="kt">AdEvent</span><span class="o">.</span><span class="n">adDidRequestResume</span><span class="p">]</span>

<span class="n">player</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">events</span><span class="p">:</span> <span class="n">events</span><span class="p">)</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
    <span class="k">if</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="kt">AdEvent</span><span class="o">.</span><span class="n">adDidRequestResume</span> <span class="p">{</span>
        <span class="c1">// handle adDidRequestResume</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="kt">AdEvent</span><span class="o">.</span><span class="n">adDidRequestPause</span> <span class="p">{</span>
        <span class="c1">// handle adDidRequestPause</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>
    
      <h3 id="ad-info-event">
        
        
          Ad Info Event <a href="#ad-info-event"></a>
        
        
      </h3>

<p>To observe ad info when an ad is starting use the following:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">player</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="kt">AdEvent</span><span class="o">.</span><span class="n">adStarted</span><span class="p">])</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">info</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">adInfo</span> <span class="p">{</span>
        <span class="c1">// use ad info</span>
        <span class="k">switch</span> <span class="n">info</span><span class="o">.</span><span class="n">positionType</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">preRoll</span><span class="p">:</span> <span class="c1">// handle pre roll</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">midRoll</span><span class="p">:</span> <span class="c1">// handle mid roll</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">postRoll</span><span class="p">:</span> <span class="c1">// handle post roll</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>
    
      <h3 id="ad-cue-points-event">
        
        
          Ad Cue Points Event <a href="#ad-cue-points-event"></a>
        
        
      </h3>

<p>To observe ad cue points update use the following:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">player</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="kt">AdEvent</span><span class="o">.</span><span class="n">adCuePointsUpdate</span><span class="p">])</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">adCuePoints</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">adCuePoints</span> <span class="p">{</span>
        <span class="c1">// use ad cue points</span>
        <span class="k">if</span> <span class="n">adCuePoints</span><span class="o">.</span><span class="n">hasPreRoll</span> <span class="o">||</span> <span class="n">adCuePoints</span><span class="o">.</span><span class="n">hasMidRoll</span> <span class="o">||</span> <span class="n">adCuePoints</span><span class="o">.</span><span class="n">hasPostRoll</span> <span class="p">{</span>
            <span class="c1">// do your stuff</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>
    
      <h2 id="have-questions-or-need-help">
        
        
          Have Questions or Need Help? <a href="#have-questions-or-need-help"></a>
        
        
      </h2>

<p>Check out the <a href="https://forum.kaltura.org/c/playkit">Kaltura Player SDK Forum</a> page for different ways of getting in touch.</p>
		
</article>


      </div>
    </div>

<!-- customer.io -->
<!--script type="text/javascript">
    var _cio = _cio || [];
    (function() {
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', 'd52b0167909beb4a2cf0');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
    })();
  </script-->
  <!-- marketo -->
  <script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('984-SDM-859');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'https://munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

<!--script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5745bb1095edd5f5"></script-->
