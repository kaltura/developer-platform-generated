  <title>Download-to-go for iOS</title>

  <meta name="description" content="VPaaS allows you to build cloud video services, supplies SDKs, and works on all devices, media workflows, and applications. Pay as you go. 
">
    <meta property="st:title" content="Download-to-go for iOS" >
    <meta property="st:published_at" content="">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
window.jQuery = window.jquery;
</script>
  <script type="text/javascript">
    try{Typekit.load();}catch(e){}
  </script>
  <link rel="apple-touch-icon" href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript">
    var switchTo5x=true;
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>

  
<script type="text/javascript">
    	
	//back to top
	if ($('#back-to-top').length) {
    		var scrollTrigger = 100, // px
	        backToTop = function () {
	            var scrollTop = $(window).scrollTop();
	            if (scrollTop > scrollTrigger) {
	                $('#back-to-top').addClass('show');
	            } else {
	                $('#back-to-top').removeClass('show');
	            }
	        };
	    backToTop();
	    $(window).on('scroll', function () {
	        backToTop();
	    });
	    $('#back-to-top a:first-child').on('click', function (e) {
	        e.preventDefault();
	        $('html,body').animate({
	            scrollTop: 0
	        }, 700);
	    });
	}

</script>

<script src='https://www.google.com/recaptcha/api.js'></script>
<script>
function verify_recapcha()
{
	var isCaptchaValidated = false;
	var response = grecaptcha.getResponse();
	if(response.length == 0) {
	    isCaptchaValidated = false;
	    alert('Please confirm that you are a Human.');
	    return false;
	} else {
	    return true;
	}

}
</script>
<!--script type="text/javascript" src="assets/js/webflow.js"></script>
<script type="text/javascript" src="assets/js/opentip-jquery.js"></script-->
    <!--script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("176893769");
  </script-->

<!--link rel="stylesheet" type="text/css" href="assets/css/lity.min.css"-->
<!--script type="text/javascript" src="assets/js/lity.min.js"></script-->

  <!-- RTP tag -->
<script type='text/javascript'>
(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
})(window,document,"rtp","https://sjrtp3-cdn.marketo.com/rtp-api/v1/rtp.js","kaltura");
rtp('send','view');
rtp('get', 'campaign',true);
</script>
<!-- End of RTP tag -->




    <div class="page-content">
      <div class="wrapper">
          <!--link rel="stylesheet" href="/site.css"-->
<article>


<div class="w-section side-nav-section">
    <div class="w-container">
      <!--a href="#" data-ix="show-temp-page-nav-column" class="w-button w-clearfix mobilebtn">Topics<span class="fa fa-chevron-down" style="null"></span></a-->
      <div class="w-row body-columns">
        <div class="docs-contents">
          <div class="post-header">

            <!-- INSERT JEKYLL CONTENT HERE -->

          	<header class="post-header">
    			<h1 class="post-title">Download-to-go for iOS</h1>
  			</header>

			
			
			<div class="lastcommittable">
				<span>Updated: Mon Mar 25 12:44:17 2019</span>, By <span class="commit-author">Jess Portnoy</span> <a class="editgithub" href="https://github.com/kaltura/developer-platform-docs/tree/master/documentation/player-portal/ios/download-to-go-ios.md" target="_blank">Contribute to this page</a>
				<!--tr><td>Created on: Tue Mar 19 11:23:35 2019, By: Avital</td></tr-->
				<!--tr><td>Last commit: Mon Mar 25 12:44:17 2019, By <span class="commit-author">Jess Portnoy</span></td></tr-->
			
				<!-- 
				
				<tr>
					<td>Avital (1 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Jess Portnoy (1 commits) (<a href="mailto:jess.portnoy@kaltura.com">jess.portnoy@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>tzubeli (1 commits) (<a href="mailto:avital.tzubeli@kaltura.com">avital.tzubeli@kaltura.com</a>)</td>
				</tr> -->

				<!--  -->

			</div>

			

		</div>

            <div class="post-content">
    		
		<p>Download to Go (DTG) is an iOS library that facilitates the download of HLS video assets.</p>
      <h2 id="supported-features">
        
        
          Supported Features <a href="#supported-features"></a>
        
        
      </h2>
<ul>
  <li>Downloading Kaltura HLS assets (Clear only)</li>
  <li>Background downloading.</li>
  <li>Resuming interrupted/paused downloads.</li>
</ul>
    
      <h2 id="known-limitations">
        
        
          Known Limitations <a href="#known-limitations"></a>
        
        
      </h2>
<ul>
  <li>No track selection (downloads all tracks)</li>
  <li>Canâ€™t play downloaded assets in background</li>
</ul>
    
      <h2 id="installation">
        
        
          Installation <a href="#installation"></a>
        
        
      </h2>
    
      <h3 id="cocoapods">
        
        
          <a href="https://cocoapods.org/">CocoaPods</a> <a href="#cocoapods"></a>
        
        
      </h3>

<p>Add this to your podfile:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">pod</span> <span class="s1">'DownloadToGo'</span>
</code></pre>
</div>
    
      <h2 id="overview">
        
        
          Overview <a href="#overview"></a>
        
        
      </h2>
    
      <h3 id="simple-flow">
        
        
          Simple Flow <a href="#simple-flow"></a>
        
        
      </h3>

<p><img src="simple-flow.svg" alt="" /></p>

<div hidden="">
<p><img src="assets/uml/0f2cd3f42ef0f55bb22f76b4f3d265d4.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>
</div>

<blockquote>
  <p>Note:</p>
  <ul>
    <li>Failed is a temp state, the delegate will notify and item has failed and content manager will remove this item. In addition, keep in mind that when receiving failed state an error will also be provided in the delegate to indicate the reason.</li>
    <li>There is also <code class="highlighter-rouge">Removed</code> state which is not displayed here. <code class="highlighter-rouge">Removed</code> is a temporary state indicated an item was removed (can be considered as an event). You can remove an item from all states.</li>
  </ul>
</blockquote>
    
      <h3 id="download-sequence">
        
        
          Download Sequence <a href="#download-sequence"></a>
        
        
      </h3>

<p><img src="download-sequence.svg" alt="" /></p>

<div hidden="">
<p><img src="assets/uml/87a7967a6090e77a1ac1715f9a4fdb85.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>
</div>
    
      <h3 id="simple-playing-sequence-using-playkit-player">
        
        
          Simple Playing Sequence (Using PlayKit Player) <a href="#simple-playing-sequence-using-playkit-player"></a>
        
        
      </h3>

<p><img src="playing-sequence.svg" alt="" /></p>

<div hidden="">
<p><img src="assets/uml/4fe4e1d6d6b95b7e4ca58e967d82cfad.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>
</div>
    
      <h2 id="usage">
        
        
          Usage <a href="#usage"></a>
        
        
      </h2>

<p>To use the DTG make sure to import in each source file:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">DownloadToGo</span>
</code></pre>
</div>

<p>The following classes/interfaces are the public API of the library:</p>
<ul>
  <li><code class="highlighter-rouge">ContentManager</code> - Use this class to interact with the library.</li>
  <li><code class="highlighter-rouge">DTGContentManager</code> - This is the main API you will use to interact with the library.</li>
  <li><code class="highlighter-rouge">ContentManagerDelegate</code> - Delegate calls available to observe.</li>
  <li><code class="highlighter-rouge">DTGItem</code> - Represent a single download item.</li>
  <li><code class="highlighter-rouge">DTGItemState</code> - The state of a download item.</li>
</ul>

<p>Basic Implementation:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DownloadManager</span><span class="p">:</span> <span class="kt">ContentManagerDelegate</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">cm</span><span class="p">:</span> <span class="kt">DTGContentManager</span>

    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// setup content manager and delegate</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="kt">ContentManager</span><span class="o">.</span><span class="n">shared</span>
        <span class="n">cm</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">downloadItem</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="nf">addItem</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">,</span> <span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="c1">// make sure the item was added</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">cm</span><span class="o">.</span><span class="nf">loadItemMetadata</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">selectedItem</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">preferredVideoBitrate</span><span class="p">:</span> <span class="mi">300000</span><span class="p">)</span>    <span class="p">{</span>
                <span class="c1">// metadata loaded</span>
                <span class="k">try</span> <span class="n">cm</span><span class="o">.</span><span class="nf">startItem</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">selectedItem</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="c1">// handle errors</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">playbackUrl</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">URL</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">try</span> <span class="n">downloadManager</span><span class="o">.</span><span class="nf">itemPlaybackUrl</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="c1">// handle errors</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">item</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">didDownloadData</span> <span class="nv">totalBytesDownloaded</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">,</span> <span class="nv">totalBytesEstimated</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?)</span> <span class="p">{</span>
        <span class="c1">// handle progress updates</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">item</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">didChangeToState</span> <span class="nv">newState</span><span class="p">:</span> <span class="kt">DTGItemState</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">?)</span> <span class="p">{</span>
        <span class="c1">// handle state changes (metadataLoaded, inProgress, completed etc...)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Basic Implementation with PlayKit:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">VideoViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">downloadManager</span> <span class="o">=</span> <span class="kt">DownloadManager</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">Player</span><span class="p">?</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">playerView</span><span class="p">:</span> <span class="kt">PlayerView</span><span class="o">!</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">player</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">PlayKitManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">loadPlayer</span><span class="p">(</span><span class="nv">pluginConfig</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
            <span class="n">player</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">playerView</span>

            <span class="kt">ContentManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">localUrl</span> <span class="o">=</span> <span class="n">downloadManager</span><span class="o">.</span><span class="nf">playbackUrl</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"myLocalId"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">mediaEntry</span> <span class="o">=</span> <span class="n">localAssetsManager</span><span class="o">.</span><span class="nf">createLocalMediaEntry</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="s">"myLocalId"</span><span class="p">,</span> <span class="nv">localURL</span><span class="p">:</span> <span class="n">localUrl</span><span class="p">)</span>
                    <span class="n">player</span><span class="o">.</span><span class="nf">prepare</span><span class="p">(</span><span class="kt">MediaConfig</span><span class="p">(</span><span class="nv">mediaEntry</span><span class="p">:</span> <span class="n">mediaEntry</span><span class="p">))</span>
                    <span class="c1">// you can now call prepare when you want (in case no error)</span>
                <span class="p">}</span>
            <span class="p">}</span>            
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="c1">// handle errors</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>On <code class="highlighter-rouge">AppDelegate</code>:</p>
<ul>
  <li>Make sure to call <code class="highlighter-rouge">ContentManager.shared.setup()</code></li>
  <li>(Optional) This is a good place to call <code class="highlighter-rouge">ContentManager.shared.startItems(inStates: _)</code> to resume interrupted or in progress downloads.</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">@UIApplicationMain</span>
<span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// setup the content manager - THIS IS A MUST!</span>
        <span class="kt">ContentManager</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">setup</span><span class="p">()</span>
        
        <span class="c1">// this can be a good place to call:</span>
        <span class="c1">// ContentManager.shared.startItems(inStates: _)</span>
        <span class="c1">// With the needed states (inProgress/paused/interrupted)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>Note: Make sure to call <code class="highlighter-rouge">ContentManager.shared.stop()</code> when finished with playback.</p>
</blockquote>
		
</article>


      </div>
    </div>

<!-- customer.io -->
<!--script type="text/javascript">
    var _cio = _cio || [];
    (function() {
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', 'd52b0167909beb4a2cf0');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
    })();
  </script-->
  <!-- marketo -->
  <script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('984-SDM-859');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'https://munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

<!--script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5745bb1095edd5f5"></script-->
