  <title>VPaaS - Video Platform as a Service | Kaltura</title>

  <meta name="description" content="VPaaS allows you to build cloud video services, supplies SDKs, and works on all devices, media workflows, and applications. Pay as you go. 
">
    <meta property="st:title" content="" >
    <meta property="st:published_at" content="">
  <!--link rel="stylesheet" href="/css/main.css"-->
  <!--link rel="canonical" href="http://localhost:4000/documentation/Mobile-Video-Player-SDKs/v3_Android_Offline.html">
  <link rel="alternate" type="application/rss+xml" title="VPaaS - Video Platform as a Service | Kaltura" href="http://localhost:4000/feed.xml">
<link rel="sitemap" type="application/xml" title="Sitemap" href="http://localhost:4000/sitemap.xml" />
  
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/normalize.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/webflow.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/kaltura-dev-site.webflow.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/syntax.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/opentip.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/moving-logo.css"-->

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
window.jQuery = window.jquery;
</script>
<!--script type="text/javascript" src="assets/js/jekyll-code-example-buttons.js"></script-->
<!--link rel="stylesheet" href="/css/highlightjs.css"-->
    <!--script src="assets/js/highlight.pack.js"></script-->
    <script>hljs.initHighlightingOnLoad();</script>
    
  <!--script type="text/javascript" src="https://use.typekit.net/rlx4cjm.js"></script-->
  <script type="text/javascript">
    try{Typekit.load();}catch(e){}
  </script>
  <!--script type="text/javascript" src="assets/js/modernizr.js"></script-->
  <link rel="apple-touch-icon" href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript">
    var switchTo5x=true;
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>

  
<!--script src="assets/js/country.js"></script-->

<!--script type="text/javascript" src="assets/js/jQuery.exLink/jquery.exLink.js"></script-->
<!--link rel="stylesheet" type="text/css" href="assets/js/jQuery.exLink/jquery.exLink.css"-->
<script type="text/javascript">
exLink.init({
    	parentElementPath: '.template-page-content-column .post-content',
 	linkWarning: false,
	hostCompare: true,
	noFollow: false,
	fancyBoxIgnore: true,
	gaTracking: true,
	gaTrackLabel: 'External Links',
	gaTrackOld: false,
	fileWarning: false
    });
	//turn all headings into clicable anchors:
    /*
	$('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6').filter('[id]').each(function () {
	    $(this).html('<a href="#'+$(this).attr('id')+'" class="post-content" aria-hidden="true">'+$(this).text()+'</a>');
	});
	

	//build the "on this page" menu:
	var ToC =
	  "<nav role='navigation' class='table-of-contents'>" +
	    "<h2>On this page:</h2>" +
	    "<ul>";
	
	var newLine, el, title, link;
	var hasHeaders = false;
	$('.post-content h2').each(function() {
	  hasHeaders = true;
	  el = $(this);
	  title = el.text();
	  link = "documentation/Mobile-Video-Player-SDKs/v3_Android_Offline.md#" + el.attr("id");
	
	  newLine =
	    "<li>" +
	      "<a href='" + link + "'>" +
	        title +
	      "</a>" +
	    "</li>";
	
	  ToC += newLine;
	
	});
	
	ToC +=
	   "</ul>" +
	  "</nav>";
	
	if (hasHeaders) $("div.post-content").prepend(ToC);
	*/
    	
	//back to top
	if ($('#back-to-top').length) {
    		var scrollTrigger = 100, // px
	        backToTop = function () {
	            var scrollTop = $(window).scrollTop();
	            if (scrollTop > scrollTrigger) {
	                $('#back-to-top').addClass('show');
	            } else {
	                $('#back-to-top').removeClass('show');
	            }
	        };
	    backToTop();
	    $(window).on('scroll', function () {
	        backToTop();
	    });
	    $('#back-to-top a:first-child').on('click', function (e) {
	        e.preventDefault();
	        $('html,body').animate({
	            scrollTop: 0
	        }, 700);
	    });
	}

</script>

<script src='https://www.google.com/recaptcha/api.js'></script>
<script>
function verify_recapcha()
{
	var isCaptchaValidated = false;
	var response = grecaptcha.getResponse();
	if(response.length == 0) {
	    isCaptchaValidated = false;
	    alert('Please confirm that you are a Human.');
	    return false;
	} else {
	    return true;
	}

}
</script>
<!--script type="text/javascript" src="assets/js/webflow.js"></script>
<script type="text/javascript" src="assets/js/opentip-jquery.js"></script-->
    <!--script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("176893769");
  </script-->

<!--link rel="stylesheet" type="text/css" href="assets/css/lity.min.css"-->
<!--script type="text/javascript" src="assets/js/lity.min.js"></script-->

  <!-- RTP tag -->
<script type='text/javascript'>
(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
})(window,document,"rtp","https://sjrtp3-cdn.marketo.com/rtp-api/v1/rtp.js","kaltura");
rtp('send','view');
rtp('get', 'campaign',true);
</script>
<!-- End of RTP tag -->




    <div class="page-content">
      <div class="wrapper">
          <!--link rel="stylesheet" href="/site.css"-->
<article>


<div class="w-section side-nav-section">
    <div class="w-container">
      <!--a href="#" data-ix="show-temp-page-nav-column" class="w-button w-clearfix mobilebtn">Topics<span class="fa fa-chevron-down" style="null"></span></a-->
      <div class="w-row body-columns">
        <div class="docs-contents">
          <div class="post-header">

            <!-- INSERT JEKYLL CONTENT HERE -->

          	<header class="post-header">
    			<h1 class="post-title"></h1>
  			</header>

			
			
			<div class="lastcommittable">
				<span>Updated: Tue Jun 6 05:11:18 2017</span>, By <span class="commit-author">Ilya Ghirici</span> <a class="editgithub" href="https://github.com/kaltura/developer-platform-docs/tree/master/documentation/Mobile-Video-Player-SDKs/v3_Android_Offline.md" target="_blank">Contribute to this page</a>
				<!--tr><td>Created on: Sun Jan 29 17:25:28 2017, By: Eliza Sapir</td></tr-->
				<!--tr><td>Last commit: Tue Jun 6 05:11:18 2017, By <span class="commit-author">Ilya Ghirici</span></td></tr-->
			
				<!-- 
				
				<tr>
					<td>Eliza Sapir (1 commits) (<a href="mailto:eliza.sapir@kaltura.com">eliza.sapir@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Ilya Ghirici (1 commits) (<a href="mailto:ilya.ghirici@gmail.com">ilya.ghirici@gmail.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Jess Portnoy (2 commits) (<a href="mailto:jess.portnoy@kaltura.com">jess.portnoy@kaltura.com</a>)</td>
				</tr> -->

				<!--  -->

			</div>

			

		</div>

            <div class="post-content">
    		
    		<h2 id="offline-playback">Offline Playback</h2>

<p>This article describes how to implement offline playback in Playkit SDK on Android devices.</p>

<p>First, download the media you wish to play. If you are looking for a good download manager you can use <a href="https://github.com/kaltura/playkit-dtg-android">this</a> one. In general the most complex part of the playback in offline is managing the DRM content license, but we’ve already covered that issue for you.</p>

<h2 id="registering-the-asset">Registering the Asset</h2>

<p>First, you’ll need to create an instance of the <a href="https://github.com/kaltura/playkit-android/blob/develop/playkit/src/main/java/com/kaltura/playkit/LocalAssetsManager.java">LocalAssetManager</a>.</p>

<p>Note that you have two constructors for this object; however, the first constructor only receives Android context.</p>

<blockquote>
  <p><strong>Important!</strong> The context must be the Android Application context.</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="c1">//Create new instance of localAssetManager with default implementatoin of LocalDataStore.</span>
  <span class="n">LocalAssetsManager</span> <span class="n">localAssetsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</code></pre>
</div>

<p>Next, accept an additional parameter of type <a href="https://github.com/kaltura/playkit-android/blob/develop/playkit/src/main/java/com/kaltura/playkit/LocalDataStore.java">LocalDataStore</a>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="c1">//Create new instance of localAssetManager with custom implementatoin of LocalDataStore.</span>
  <span class="n">LocalAssetsManager</span> <span class="n">localAssetsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">YourLocalDataStore</span><span class="o">);</span>
</code></pre>
</div>

<p>In first constructor, we implicitly implemented the <a href="https://github.com/kaltura/playkit-android/blob/develop/playkit/src/main/java/com/kaltura/playkit/LocalDataStore.java">LocalDataStore</a> interface in the DefaultLocalDataStore class (which is actually an inner class of the LocalAssetsManager). In the second constructor, you can have your own implementation of this interface. You can read more about the LocalDataStore later in this section. For now, let’s use the default constructor.</p>

<p>Register the asset to the LocalAssetsManager. Note that you’ll need to be <strong><em>Online</em></strong> while doing so.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="c1">//This listener will notify you about success/fail of the registration process.</span>
  <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetRegistrationListener</span> <span class="n">registrationListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetRegistrationListener</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRegistered</span><span class="o">(</span><span class="n">String</span> <span class="n">assetPath</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span> <span class="s">"asset registered "</span> <span class="o">+</span> <span class="n">assetPath</span><span class="o">);</span>
                    <span class="o">}</span>

                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailed</span><span class="o">(</span><span class="n">String</span> <span class="n">assetPath</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span> <span class="s">"asset onFailed "</span> <span class="o">+</span> <span class="n">assetPath</span> <span class="o">+</span> <span class="s">" ex "</span> <span class="o">+</span> <span class="n">error</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                    <span class="o">}</span>
                <span class="o">});</span>

  <span class="c1">//Actually register asset.</span>
  <span class="n">localAssetsManager</span><span class="o">.</span><span class="na">registerAsset</span><span class="o">(</span><span class="n">mediaSource</span><span class="o">,</span> <span class="n">yourAssetAbsolutePath</span><span class="o">,</span> <span class="n">yourAssetID</span><span class="o">,</span> <span class="n">registrationListener</span><span class="o">);</span>

</code></pre>
</div>
<p>As you can see, you’ll have to pass four parameters to the registration method:</p>

<ul>
  <li>mediaSource - the <a href="">PKMediaSource</a> object.</li>
  <li>localAssetPath - the absolute local path, where the asset is stored.</li>
  <li>assetId - the assetId.</li>
  <li>LocalAssetsManager.AssetRegistrationListener - the listener that notifies about the success/failure of the registration.</li>
</ul>

<p>If the result is successful, you’re ready to play your media in offline; to do so, simply create a new instance of the LocalAssetsManager(or reuse the existing one), and ask it for the media source, and then pass the localAssetPath of the desired media and the assetId. The LocalAssetsManager will return the PKMediaSource, which can play the media without a network connection.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="n">LocalAssetsManager</span> <span class="n">localAssetsManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
  <span class="n">PKMediaSource</span> <span class="n">mediaSource</span> <span class="o">=</span> <span class="n">localAssetsManager</span><span class="o">.</span><span class="na">getLocalMediaSource</span><span class="o">(</span><span class="n">assetId</span><span class="o">,</span> <span class="n">localAssetPath</span><span class="o">);</span>

</code></pre>
</div>

<p>Next, set the mediaSource to your PKMediaEntry and pass the PlayerConfig to the player.preapre(PlayerConfig config) method.</p>

<h2 id="additional-functionality">Additional Functionality</h2>

<p>The LocalAssetsManager can provide you with some additional functionality. For example you can unregister the asset and check the asset status.</p>

<h3 id="unregistering-an-asset">Unregistering an Asset</h3>

<p>To unregister the asset:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="c1">//This listener will notify you about success when the asset was unregistered.</span>
  <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetRemovalListener</span> <span class="n">removalListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetAssetRemovalListener</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRemoved</span><span class="o">(</span><span class="n">String</span> <span class="n">assetPath</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span> <span class="s">"asset removed "</span> <span class="o">+</span> <span class="n">assetPath</span><span class="o">);</span>
                    <span class="o">}</span>
         		 <span class="o">});</span>

  <span class="c1">//Actually unregister asset.</span>
  <span class="n">localAssetsManager</span><span class="o">.</span><span class="na">unregisterAsset</span><span class="o">(</span><span class="n">yourAssetLocalPath</span><span class="o">,</span> <span class="n">yourAssetID</span><span class="o">,</span> <span class="n">removalListener</span><span class="o">);</span>

</code></pre>
</div>
<h3 id="checking-the-assets-drm-status">Checking the Asset’s DRM Status</h3>

<p>To check the asset’s DRM:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>  <span class="c1">//This listener will notify you about expiration/availability time of the drm license.</span>
  <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetStatusListener</span> <span class="n">assetStatusListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalAssetsManager</span><span class="o">.</span><span class="na">AssetStatusListener</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStatus</span><span class="o">(</span><span class="n">String</span> <span class="n">localAssetPath</span><span class="o">,</span> <span class="kt">long</span> <span class="n">expiryTimeSeconds</span><span class="o">,</span> <span class="kt">long</span> <span class="n">availableTimeSeconds</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span> <span class="s">"asset status for "</span> <span class="o">+</span> <span class="n">assetPath</span> <span class="o">+</span> <span class="s">": expirity time in seconds "</span> <span class="o">+</span> <span class="n">expiryTimeSeconds</span> <span class="o">+</span> <span class="s">" available  time in seconds "</span> <span class="o">+</span> <span class="n">availableTimeSeconds</span><span class="o">);</span>
                    <span class="o">}</span>
         		 <span class="o">});</span>

  <span class="c1">//Actually check the asset status.</span>
  <span class="n">localAssetsManager</span><span class="o">.</span><span class="na">checkAssetStatus</span><span class="o">(</span><span class="n">yourAssetLocalPath</span><span class="o">,</span> <span class="n">yourAssetID</span><span class="o">,</span> <span class="n">assetStatusListener</span><span class="o">);</span>
</code></pre>
</div>

<h2 id="localdatastore">LocalDataStore</h2>

<p>The LocalDataStore is an interface that has three methods:</p>

<ul>
  <li>void save(String key, byte[] value);</li>
  <li>byte[] load(String key) throws FileNotFoundException;</li>
  <li>void remove(String key);</li>
</ul>

<p>Kaltura uses a default implementation of the LocalDataStore that uses Android SharedPreferences to save/load/remove the data. This implementation is responsible for storing the DRM keySetId to play DRM videos in offline. If your content doesn’t have DRM protection, you can use this implementation freely. Howevever, you’ll likely want to implement your own way of storing this data. To do so, you’ll need to implement LocalDataStore and verify that you are actually saving/loading/removing the data that you receive.</p>

<p>&lt;/br&gt;</p>

<h2 id="have-questions-or-need-help">Have Questions or Need Help?</h2>

<p>Check out the <a href="https://forum.kaltura.org/c/playkit">Kaltura Player SDK Forum</a> page for different ways of getting in touch.</p>

		
</article>


      </div>
    </div>

<!-- customer.io -->
<!--script type="text/javascript">
    var _cio = _cio || [];
    (function() {
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', 'd52b0167909beb4a2cf0');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
    })();
  </script-->
  <!-- marketo -->
  <script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('984-SDM-859');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'https://munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

<!--script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5745bb1095edd5f5"></script-->
