  <title>VPaaS - Video Platform as a Service | Kaltura</title>

  <meta name="description" content="VPaaS allows you to build cloud video services, supplies SDKs, and works on all devices, media workflows, and applications. Pay as you go. 
">
    <meta property="st:title" content="" >
    <meta property="st:published_at" content="">
  <!--link rel="stylesheet" href="/css/main.css"-->
  <!--link rel="canonical" href="http://localhost:4000/documentation/Mobile-Video-Player-SDKs/v3_iOS_Offline.html">
  <link rel="alternate" type="application/rss+xml" title="VPaaS - Video Platform as a Service | Kaltura" href="http://localhost:4000/feed.xml">
<link rel="sitemap" type="application/xml" title="Sitemap" href="http://localhost:4000/sitemap.xml" />
  
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/normalize.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/webflow.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/kaltura-dev-site.webflow.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/syntax.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/opentip.css">
<link rel="stylesheet" type="text/css" href="http://localhost:4000/css/moving-logo.css"-->

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
window.jQuery = window.jquery;
</script>
<!--script type="text/javascript" src="assets/js/jekyll-code-example-buttons.js"></script-->
<!--link rel="stylesheet" href="/css/highlightjs.css"-->
    <!--script src="assets/js/highlight.pack.js"></script-->
    <script>hljs.initHighlightingOnLoad();</script>
    
  <!--script type="text/javascript" src="https://use.typekit.net/rlx4cjm.js"></script-->
  <script type="text/javascript">
    try{Typekit.load();}catch(e){}
  </script>
  <!--script type="text/javascript" src="assets/js/modernizr.js"></script-->
  <link rel="apple-touch-icon" href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript">
    var switchTo5x=true;
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>

  
<!--script src="assets/js/country.js"></script-->

<!--script type="text/javascript" src="assets/js/jQuery.exLink/jquery.exLink.js"></script-->
<!--link rel="stylesheet" type="text/css" href="assets/js/jQuery.exLink/jquery.exLink.css"-->
<script type="text/javascript">
exLink.init({
    	parentElementPath: '.template-page-content-column .post-content',
 	linkWarning: false,
	hostCompare: true,
	noFollow: false,
	fancyBoxIgnore: true,
	gaTracking: true,
	gaTrackLabel: 'External Links',
	gaTrackOld: false,
	fileWarning: false
    });
	//turn all headings into clicable anchors:
    /*
	$('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6').filter('[id]').each(function () {
	    $(this).html('<a href="#'+$(this).attr('id')+'" class="post-content" aria-hidden="true">'+$(this).text()+'</a>');
	});
	

	//build the "on this page" menu:
	var ToC =
	  "<nav role='navigation' class='table-of-contents'>" +
	    "<h2>On this page:</h2>" +
	    "<ul>";
	
	var newLine, el, title, link;
	var hasHeaders = false;
	$('.post-content h2').each(function() {
	  hasHeaders = true;
	  el = $(this);
	  title = el.text();
	  link = "documentation/Mobile-Video-Player-SDKs/v3_iOS_Offline.md#" + el.attr("id");
	
	  newLine =
	    "<li>" +
	      "<a href='" + link + "'>" +
	        title +
	      "</a>" +
	    "</li>";
	
	  ToC += newLine;
	
	});
	
	ToC +=
	   "</ul>" +
	  "</nav>";
	
	if (hasHeaders) $("div.post-content").prepend(ToC);
	*/
    	
	//back to top
	if ($('#back-to-top').length) {
    		var scrollTrigger = 100, // px
	        backToTop = function () {
	            var scrollTop = $(window).scrollTop();
	            if (scrollTop > scrollTrigger) {
	                $('#back-to-top').addClass('show');
	            } else {
	                $('#back-to-top').removeClass('show');
	            }
	        };
	    backToTop();
	    $(window).on('scroll', function () {
	        backToTop();
	    });
	    $('#back-to-top a:first-child').on('click', function (e) {
	        e.preventDefault();
	        $('html,body').animate({
	            scrollTop: 0
	        }, 700);
	    });
	}

</script>

<script src='https://www.google.com/recaptcha/api.js'></script>
<script>
function verify_recapcha()
{
	var isCaptchaValidated = false;
	var response = grecaptcha.getResponse();
	if(response.length == 0) {
	    isCaptchaValidated = false;
	    alert('Please confirm that you are a Human.');
	    return false;
	} else {
	    return true;
	}

}
</script>
<!--script type="text/javascript" src="assets/js/webflow.js"></script>
<script type="text/javascript" src="assets/js/opentip-jquery.js"></script-->
    <!--script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("176893769");
  </script-->

<!--link rel="stylesheet" type="text/css" href="assets/css/lity.min.css"-->
<!--script type="text/javascript" src="assets/js/lity.min.js"></script-->

  <!-- RTP tag -->
<script type='text/javascript'>
(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
})(window,document,"rtp","https://sjrtp3-cdn.marketo.com/rtp-api/v1/rtp.js","kaltura");
rtp('send','view');
rtp('get', 'campaign',true);
</script>
<!-- End of RTP tag -->




    <div class="page-content">
      <div class="wrapper">
          <!--link rel="stylesheet" href="/site.css"-->
<article>


<div class="w-section side-nav-section">
    <div class="w-container">
      <!--a href="#" data-ix="show-temp-page-nav-column" class="w-button w-clearfix mobilebtn">Topics<span class="fa fa-chevron-down" style="null"></span></a-->
      <div class="w-row body-columns">
        <div class="docs-contents">
          <div class="post-header">

            <!-- INSERT JEKYLL CONTENT HERE -->

          	<header class="post-header">
    			<h1 class="post-title"></h1>
  			</header>

			
			
			<div class="lastcommittable">
				<span>Updated: Sun Feb 5 07:52:41 2017</span>, By <span class="commit-author">AnnaAleksandrowicz</span> <a class="editgithub" href="https://github.com/kaltura/developer-platform-docs/tree/master/documentation/Mobile-Video-Player-SDKs/v3_iOS_Offline.md" target="_blank">Contribute to this page</a>
				<!--tr><td>Created on: Wed Jan 18 11:49:21 2017, By: Eliza Sapir</td></tr-->
				<!--tr><td>Last commit: Sun Feb 5 07:52:41 2017, By <span class="commit-author">AnnaAleksandrowicz</span></td></tr-->
			
				<!-- 
				
				<tr>
					<td>AnnaAleksandrowicz (7 commits) (<a href="mailto:Anna.Aleksandrowicz@kaltura.com">Anna.Aleksandrowicz@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Eliza Sapir (1 commits) (<a href="mailto:eliza.sapir@kaltura.com">eliza.sapir@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>ElizaSapir (1 commits) (<a href="mailto:eliza.sapir@kaltura.com">eliza.sapir@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Jess Portnoy (2 commits) (<a href="mailto:jess.portnoy@kaltura.com">jess.portnoy@kaltura.com</a>)</td>
				</tr> -->

				<!-- 
				
				<tr>
					<td>Noam Tamim (2 commits) (<a href="mailto:noam.tamim@kaltura.com">noam.tamim@kaltura.com</a>)</td>
				</tr> -->

				<!--  -->

			</div>

			

		</div>

            <div class="post-content">
    		
    		<h2 id="offline-playback">Offline Playback</h2>

<p>Offline Playback refers to the ability to play downloaded content, although the device doesn’t actually have to be offline (i.e., without network access) to use downloaded assets.</p>

<p>Conceptually, setting up offline playback requires three steps:</p>

<ol>
  <li>Download the content</li>
  <li>Register the downloaded content with the SDK</li>
  <li>Play the downloaded content.</li>
</ol>

<p>Download itself is out of scope for this document; it is done either by <a href="https://developer.apple.com/reference/avfoundation/avassetdownloadtask">AVAssetDownloadTask</a> (available in iOS 10 and up) or by a third party download manager.</p>

<p>The main SDK component responsible for local playback is <a href="https://kaltura.github.io/playkit/api/ios/Classes/LocalAssetsManager.html">LocalAssetsManager</a>. This class is used before and right after the download to make sure the SDK retrieves DRM licenses for offline playback. It is also used when starting local playback, to link the downloaded content with a <a href="https://kaltura.github.io/playkit/api/ios/Classes/MediaEntry.html">MediaEntry</a> object playable by the SDK.</p>

<h2 id="download-and-register">Download and Register</h2>

<h3 id="downloading-with-avassetdownloadtask">Downloading with AVAssetDownloadTask</h3>

<p>When using AVAssetDownloadTask, an application has to create an AVURLAsset and link it to a download task. In addition, if the asset is protected with FairPlay DRM, a delegate on the asset must be set.</p>

<p>Before starting to download, the application should have a ready-to-use MediaEntry object, containing one or more <code class="highlighter-rouge">MediaSource</code>s.</p>

<p>The application should then call <code class="highlighter-rouge">prepareForDownload(of mediaEntry: MediaEntry)</code> - which will pick the most suitable source for the download and return two values:</p>
<ul>
  <li>A downloadable <code class="highlighter-rouge">AVURLAsset</code>, configured with FairPlay if required</li>
  <li>The original <code class="highlighter-rouge">MediaSource</code> from which the <code class="highlighter-rouge">AVURLAsset</code> was built.</li>
</ul>

<p>At this point, the application can start downloading the asset (typically mp4 or HLS).</p>

<p><img src="assets/uml/964d7d743a970ea5423706a0b95a6635.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>

<p>For correct usage of this mechanism, please see <a href="https://developer.apple.com/library/content/documentation/AudioVideo/Conceptual/MediaPlaybackGuide/Contents/Resources/en.lproj/HTTPLiveStreaming/HTTPLiveStreaming.html">Apple’s guide</a> and a <a href="https://developer.apple.com/library/content/samplecode/HLSCatalog/Introduction/Intro.html">sample application</a>.</p>

<h3 id="downloading-with-a-3rd-party-tool">Downloading with a 3rd-party tool</h3>

<p>When the asset isn’t downloadable by AVAssetDownloadTask (or if AVAssetDownloadTask is not available), the download will be done either with a 3rd party tool or by using a <a href="https://developer.apple.com/reference/foundation/urlsessiondownloadtask">URLSessionDownloadTask</a>.  In these cases, there’s no “preparation” step; instead, the application calls <code class="highlighter-rouge">getPreferredDownloadableMediaSource(for mediaEntry: MediaEntry)</code> to pick the best source. It then downloads the source, and at the end calls <code class="highlighter-rouge">assetDownloadFinished(mediaSource: MediaSource, location: URL)</code>.</p>

<p>This case also applies to <em>Widevine Classic</em> assets.</p>

<p><img src="assets/uml/55debeca875ccc0c93aaeb89dff72762.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>

<h2 id="playback">Playback</h2>

<p>To play a downloaded asset, the application needs to wrap the asset with a MediaEntry object. <code class="highlighter-rouge">LocalAssetsManager</code> provides <code class="highlighter-rouge">createLocalMediaEntry(for assetId: String, localURL: URL)</code>. This function returns a suitable <code class="highlighter-rouge">MediaEntry</code>.</p>

<p><img src="assets/uml/6bf3c5bec6723bd675bda2d13e11368f.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>

<h2 id="localdatastore">LocalDataStore</h2>

<p>The constructor of LocalAssetsManager takes an optional <a href="https://kaltura.github.io/playkit/api/ios/Protocols/LocalDataStore.html">LocalDataStore</a>. This object is <strong>require</strong> if the application downloads or plays DRM-protected content. The protocol has 3 functions:</p>
<ul>
  <li><code class="highlighter-rouge">save(key: String, value: Data)</code></li>
  <li><code class="highlighter-rouge">load(key: String) -&gt; Data</code></li>
  <li><code class="highlighter-rouge">remove(key: String)</code></li>
</ul>

<p>A simple implementation is provided in <a href="https://kaltura.github.io/playkit/api/ios/Classes/DefaultLocalDataStore.html">DefaultLocalDataStore</a>, but if the application has an existing persistent storage facility (such as a CoreData/SQLite db), it might be good idea to provide a different implementation.</p>

<h3 id="have-questions-or-need-help">Have Questions or Need Help?</h3>

<p>Check out the <a href="https://forum.kaltura.org/c/playkit">Kaltura Player SDK Forum</a> page for different ways of getting in touch.</p>

		
</article>


      </div>
    </div>

<!-- customer.io -->
<!--script type="text/javascript">
    var _cio = _cio || [];
    (function() {
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', 'd52b0167909beb4a2cf0');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
    })();
  </script-->
  <!-- marketo -->
  <script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('984-SDM-859');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'https://munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>

<!--script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5745bb1095edd5f5"></script-->
